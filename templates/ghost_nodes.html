<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ghost Sentinel Hub – ACCENET Ghost Network</title>
  <style>
    body {
      background: #020617;
      color: #e5e7eb;
      font-family: "Fira Code", monospace;
      margin: 0;
      padding: 0;
    }
    .wrap {
      max-width: 960px;
      margin: 24px auto;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid #22c55e55;
      box-shadow: 0 0 30px #22c55e33;
      background: radial-gradient(circle at top, #020617, #000000);
    }
    h1 {
      margin-top: 0;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 1rem;
      color: #bbf7d0;
    }
    .subtitle {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-bottom: 12px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #1f2937;
    }
    th {
      text-align: left;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.75rem;
      color: #a5b4fc;
    }
    tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.6);
    }
    a {
      color: #7dd3fc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* --- World Chat + Bot (theme-matched) --- */
    .panel {
      margin-top: 14px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #22c55e22;
      box-shadow: 0 0 20px #22c55e1a;
      background: rgba(15, 23, 42, 0.35);
    }
    .panel h2 {
      margin: 0 0 6px 0;
      text-transform: uppercase;
      letter-spacing: 0.10em;
      font-size: 0.85rem;
      color: #bbf7d0;
    }
    code {
      background: rgba(15, 23, 42, 0.7);
      padding: 1px 6px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      color: #bbf7d0;
    }
    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 8px;
    }
    .field, .btn {
      font-family: "Fira Code", monospace;
      font-size: 0.8rem;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: rgba(2, 6, 23, 0.7);
      color: #e5e7eb;
      outline: none;
    }
    .field::placeholder { color: #64748b; }
    .btn {
      cursor: pointer;
      border-color: #22c55e55;
      box-shadow: 0 0 14px #22c55e22;
    }
    .btn:hover { border-color: #22c55eaa; }
    .pill {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      font-size: 0.75rem;
      color: #9ca3af;
      background: rgba(2, 6, 23, 0.6);
    }
    .pill.ok { color: #bbf7d0; border-color: #22c55e55; }
    .pill.warn { color: #fcd34d; border-color: #fcd34d55; }

    #chatLog {
      height: 300px;
      overflow: auto;
      margin-top: 10px;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: rgba(2, 6, 23, 0.55);
    }
    .msg { margin: 0 0 10px 0; }
    .msg .meta { color: #9ca3af; font-size: 0.72rem; }
    .msg .text { color: #e5e7eb; font-size: 0.82rem; white-space: pre-wrap; }

    .hint {
      margin-top: 10px;
      font-size: 0.78rem;
      color: #9ca3af;
      line-height: 1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ghost Sentinel Hub • ACCENET Ghost Network</h1>
    <div class="subtitle">
      Nodes register here when they open Cloudflare tunnels.
      Each row is a ghost door into one of your Sentinel worlds.
    </div>

    {% if not nodes %}
      <p>No nodes have registered yet. Once your local node runs
      <code>sentinel_remote_access_ghost.py</code> and opens a tunnel,
      it will appear here.</p>
    {% else %}
      <table>
        <thead>
          <tr>
            <th>Node</th>
            <th>Service</th>
            <th>Public URL</th>
            <th>Last Seen (UTC)</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in nodes %}
          <tr>
            <td>{{ entry.node }}</td>
            <td>{{ entry.service }}</td>
            <td><a href="{{ entry.url }}" target="_blank" rel="noreferrer">{{ entry.url }}</a></td>
            <td>{{ entry.last_seen }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}

    <div class="panel">
      <h2>World Chat + Builder Bot</h2>
      <div class="subtitle" style="margin: 0;">
        Join rooms like <code>#101</code> or <code>#sanctuary</code>. Bot commands start with <code>!</code> (type <code>!help</code>).
      </div>

      <div class="row">
        <input id="userName" class="field" placeholder="Name (e.g. Cohen)" style="flex: 1; min-width: 180px;" />
        <input id="roomName" class="field" value="#101" placeholder="#room" style="width: 160px;" />
        <button id="joinBtn" class="btn">Join</button>
        <button id="leaveBtn" class="btn">Leave</button>
        <span id="status" class="pill warn">disconnected</span>
        <span class="pill">room: <b id="roomLabel">—</b></span>
      </div>

      <div id="chatLog"></div>

      <div class="row">
        <input id="chatMsg" class="field" placeholder="Message… (try: !world create --biome forest --magic high --factions 3)" style="flex: 1; min-width: 220px;" />
        <button id="sendBtn" class="btn">Send</button>
      </div>

      <div class="hint">
        Quick starts:<br>
        <code>!world create --name "Sanctuary-101" --biome forest --magic high --factions 3</code><br>
        <code>!home add "Marble Foyer" --style gothic --size large</code><br>
        <code>!home door add --from "Marble Foyer" --to "Library"</code><br>
        <code>!map</code>
      </div>
    </div>

  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    const statusEl = document.getElementById("status");
    const roomLabel = document.getElementById("roomLabel");
    const logEl = document.getElementById("chatLog");

    let socket = null;
    let currentRoom = null;

    function appendMsg(m) {
      const div = document.createElement("div");
      div.className = "msg";
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = `[${m.ts}] ${m.sender} @ ${m.room}`;
      const text = document.createElement("div");
      text.className = "text";
      text.textContent = m.msg;
      div.appendChild(meta);
      div.appendChild(text);
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function setStatus(ok, text) {
      statusEl.textContent = text;
      statusEl.className = "pill " + (ok ? "ok" : "warn");
    }

    function ensureSocket() {
      if (socket) return;
      socket = io();
      socket.on("connect", () => setStatus(true, "connected"));
      socket.on("disconnect", () => setStatus(false, "disconnected"));
      socket.on("chat_history", (items) => {
        logEl.innerHTML = "";
        (items || []).forEach(appendMsg);
      });
      socket.on("chat_message", (m) => appendMsg(m));
    }

    function joinRoom() {
      const user = (document.getElementById("userName").value || "guest").trim();
      const room = (document.getElementById("roomName").value || "#101").trim() || "#101";
      ensureSocket();
      if (currentRoom) socket.emit("leave", { room: currentRoom, user });
      currentRoom = room;
      roomLabel.textContent = room;
      socket.emit("join", { room, user });
    }

    document.getElementById("joinBtn").addEventListener("click", joinRoom);

    document.getElementById("leaveBtn").addEventListener("click", () => {
      if (!socket || !currentRoom) return;
      const user = (document.getElementById("userName").value || "guest").trim();
      socket.emit("leave", { room: currentRoom, user });
      currentRoom = null;
      roomLabel.textContent = "—";
      logEl.innerHTML = "";
    });

    document.getElementById("sendBtn").addEventListener("click", () => {
      if (!socket || !currentRoom) return;
      const user = (document.getElementById("userName").value || "guest").trim();
      const msgBox = document.getElementById("chatMsg");
      const msg = (msgBox.value || "").trim();
      if (!msg) return;
      socket.emit("send_message", { room: currentRoom, user, msg });
      msgBox.value = "";
      msgBox.focus();
    });

    document.getElementById("chatMsg").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        document.getElementById("sendBtn").click();
      }
    });
  </script>
</body>
</html>
